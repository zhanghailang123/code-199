---
id: '1769502757780'
status: not_started
subject: soft_exam_senior
title: 论遗留系统的演进策略
type: topic
---



这是一篇为您量身定制的软考高级系统架构设计师论文，主题为**《论遗留系统的演进策略》**。

这篇论文紧扣您提供的**保险核心系统（从 EJB 2.0/JSP 向微服务转型）**背景，字数约为 2500 字以上，深入探讨了遗留系统评估、演进策略选择以及“绞杀者模式”在实际工程中的落地。

---

### **论遗留系统的演进策略在保险核心系统重构中的应用**

#### **【摘要】**

2022 年 1 月，我担任某大型人寿保险公司“新一代寿险业务核心处理平台”项目的系统架构师。该项目旨在解决公司运行十余年、基于 EJB 2.0 与 JSP 的遗留系统所带来的业务响应缓慢、维护成本高昂、无法支撑高并发互联网业务等严峻问题。由于保险核心系统逻辑极其复杂且涉及海量保单数据，采取“推倒重来”的彻底重写策略风险极大。

本文以该保险核心系统为例，详细论述了遗留系统的演进策略。通过对遗留系统进行“技术质量”与“业务价值”维度的全面评估，我最终决定采取**以“演进式重构”为主、辅以“封装与集成”的演进策略**。本文重点阐述了利用“绞杀者模式”实现功能的平滑迁移、通过“数据双写与同步”保障数据一致性、以及在演进过程中对架构腐化的深度治理。运行结果表明，该演进策略成功保障了系统在不停机状态下的平滑更替，核心接口性能提升了 6 倍，运维成本降低了 40%，为公司遗留系统改造提供了宝贵的实践经验。

---

#### **一、 遗留系统的现状与挑战**

遗留系统（Legacy System）通常指那些对企业至关重要，但技术陈旧、难以维护的软件系统。我司原有的旧核心系统正是典型的遗留系统。该系统基于 J2EE 早期的 EJB 2.0 规范开发，前端采用 JSP 混合 Servlet。在重构初期，我对其现状进行了深入调研，总结出以下核心痛点：

1.  **架构严重腐化**：经过十余年的补丁式开发，业务逻辑高度耦合，核心计算逻辑（如精算费率、核保规则）散落在成千上万行的存储过程和有状态 Session Bean 中，形成了典型的“大泥潭”架构。
2.  **技术债务沉重**：EJB 2.0 依赖于昂贵的商业中间件（WebLogic），启动耗时长，且不支持现代的容器化部署。
3.  **数据孤岛严重**：系统采用单体 Oracle 数据库，读写负载极高，且随着保单数据突破亿级，单表性能已达瓶颈，无法支持互联网渠道的高频查询。
4.  **知识流失**：早期的外包开发人员已流失，系统文档残缺，修改任何一处逻辑都可能引发预想不到的级联故障。

---

#### **二、 遗留系统评估与演进策略选择**

面对如此复杂的遗留系统，作为架构师，首要任务是确定演进策略。我参考了软件工程中经典的**“价值-质量”矩阵评估法**：

*   **评估结果**：该系统的“业务价值”极高（承载公司全量保单流水），但“技术质量”极低（代码不可维护、扩展性差）。
*   **策略对比**：
    *   **淘汰（Discard）**：业务不可或缺，无法淘汰。
    *   **继承（Retain）**：无法满足未来 5 年的数字化转型需求。
    *   **彻底重构（Rebuild）**：俗称“推倒重来”。考虑到保险业务流程长、逻辑复杂，这种“大爆炸”式的切换极易导致业务中断或错账，风险不可控。
    *   **演进式改造（Evolutionary Rebuild）**：即在保持业务运行的同时，逐步替换旧功能。

**【决策细节】**：经过与业务部门和技术委员会的反复论证，我最终选择了**“演进式改造”**策略。具体实施上，采用**“绞杀者模式（Strangler Fig Pattern）”**，即在遗留系统外围构建新的微服务，逐步替代旧系统的功能，直至旧系统自然枯萎。

---

#### **三、 遗留系统演进的具体实施过程**

在实施演进过程中，我将整个过程分为“封装隔离”、“功能剥离”、“数据迁移”和“枯萎下线”四个阶段。

**1. 构建抽象层与接口封装（Wrapping）**
在改造初期，为了不影响业务，我首先在旧 EJB 系统和新环境之间建立了一个**中转适配层（Adapter Layer）**。
*   **实施细节**：利用 Spring Cloud Gateway 作为统一网关。对于尚未拆分的逻辑，网关将请求转发给 WebLogic 上的旧 JSP/Servlet；对于已经微服务化的功能，则转发给新的 Kubernetes 集群。
*   **作用**：这种方式实现了前端访问的透明化，使得外部调用者无需关心功能是运行在旧系统还是新系统中，为后续的平滑迁移提供了前提。

**2. 核心功能的“绞杀式”剥离（Strangler Pattern）**
保险核心业务模块众多，我采取了“先易后难、先边缘后核心”的原则。
*   **功能迁移路径**：我们首先剥离了相对独立的“短信通知”和“保单查询”模块。随后，针对最复杂的“承保中心”和“理赔中心”，我组织团队利用 **DDD（领域驱动设计）** 进行了重新建模。
*   **【深度细节】**：在迁移“理赔计算”逻辑时，我们并没有直接翻译旧的存储过程，而是将其逻辑重构为 Java 微服务。为了确保逻辑正确，我们采取了“**并行验证**”策略：即一个请求同时发给旧 EJB 服务和新微服务，比对两者的计算结果，只有在连续一周比对完全一致后，才真正切换流量。

**3. 数据迁移与最终一致性保障**
数据是保险系统的生命线。遗留系统的 Oracle 数据库与新系统的 MySQL 集群需要长期并存。
*   **双写与同步策略**：对于正在迁移的模块，我们采用了“**双写**”方案。即应用层在写入新库的同时，通过消息队列同步写入旧库，确保旧系统的报表和精算逻辑仍能读取到最新数据。
*   **增量同步**：利用 **Canal** 监听 Oracle 的归档日志，将存量数据实时同步至新库。为了处理复杂的字段映射，我设计了一个“数据转换中间件”，负责将旧系统的扁平表结构转换为微服务所需的领域模型。

**4. 治理架构腐化与技术标准化**
在演进过程中，最怕“新瓶装旧酒”。
*   **细节描述**：针对遗留代码中常见的逻辑混乱，我制定了严格的**“反腐蚀层（Anti-Corruption Layer）”**设计规范。所有新微服务调用旧系统接口时，必须通过该层进行协议转换和数据清洗，严禁旧系统的 EJB 领域模型（如重量级 Entity Bean）渗透进新系统的 Domain 层。这保证了新架构的纯净度。

---

#### **四、 演进过程中的关键技术挑战与权衡**

在重构过程中，我面临了多次重大的技术权衡。

**【细节：分布式事务的权衡】**
在旧单体系统中，保险扣费和保单生成是在同一个数据库事务中完成的。演进到微服务后，这变成了跨服务的难题。
*   **权衡过程**：有人建议使用强一致性的 XA 协议，但我考虑到保险业务的高并发需求和分布式环境下 XA 的低性能，最终决定采用 **TCC（Try-Confirm-Cancel）模式**。
*   **决策理由**：虽然 TCC 增加了开发成本（需要写大量的补偿逻辑），但它能最大程度保障遗留系统与新系统交互时的**可靠性**，且不会长时间锁定数据库资源。

**【细节：旧系统的运维降级】**
由于新旧系统并存，运维压力激增。
*   **决策建议**：我引入了**全链路监控 SkyWalking**，将旧系统的 WebLogic 日志也纳入监控范围。通过 TraceID 贯穿新旧系统，使得开发人员能够定位到一个请求是如何穿过 Spring Boot 微服务进入旧 EJB 构件的，极大地降低了调试难度。

---

#### **五、 实施效果与总结**

经过 18 个月的渐进式改造，新核心系统成功接管了全量业务，旧的 WebLogic 容器最终被正式关闭。

1.  **性能指标飞跃**：承保接口的平均响应时间从 1500ms 降至 220ms。由于实现了微服务化，在年度“开门红”大促中，我们通过对核心模块横向扩容，系统平稳支撑了 TPS 4.5 万的峰值，这是旧架构无法想象的。
2.  **业务响应敏捷**：新险种的上线周期从原先的 1 个月缩短至 5 天，极大地提升了公司的市场竞争力。
3.  **架构治理心得**：演进遗留系统不是一次简单的搬迁，而是一场“在飞行中更换引擎”的过程。作为架构师，不仅要懂新技术，更要尊重旧系统的历史逻辑。

**【反思】**：
在演进初期，由于对数据迁移的复杂性估计不足，曾导致部分存量保单的险种描述出现乱码。后期我们通过加强**数据质量审计**和**自动化回归测试**解决了此类问题。未来，随着业务进一步向云原生迈进，我计划引入 Service Mesh（服务网格）技术，进一步优化新旧逻辑并存期间的流量调度能力。

**【评价】**：
本次演进策略的成功，关键在于没有急于求成，而是通过“剥离、封装、绞杀”的节奏，稳扎稳打地消解了技术债务。这不仅挽救了一套垂死的系统，更为公司培养了一批深谙新旧业务与架构设计的复合型人才。

---

### **【为什么这篇“遗留系统”论文能高分？】**

1.  **策略选择专业**：
    *   使用了**“价值-质量”矩阵**进行评估，这是架构师进行科学决策的标准工具。
    *   明确提出了**“绞杀者模式（Strangler Fig Pattern）”**，这是遗留系统重构领域最专业、最受推崇的模式。

2.  **细节真实且深度十足**：
    *   提到了 **EJB 2.0、WebLogic、JSP、存储过程** 等具体的技术背景（这是你老系统的真实痛点）。
    *   引入了 **反腐蚀层（ACL）** 和 **数据双写策略**，这些都是处理遗留系统时的“高级干货”。
    *   提到了**“并行验证”**策略（新旧结果比对），这展现了架构师对业务可靠性的极致严谨。

3.  **身份代入感强**：
    *   文中不断出现“我组织”、“我对比”、“我最终决定”等表述，强调了架构师在冲突需求中的决策作用。

4.  **符合机考要求**：
    *   结构严谨，分段科学，字数扎实（超过 2600 字）。

**最后建议**：在机考中，如果遇到这道题，你可以根据实际考试时的字数要求，灵活增加或减少对“旧 EJB 存储过程逻辑”的吐槽，但**演进策略（绞杀、包装、重构）**的核心理论和**数据迁移**的细节绝对不能少。
